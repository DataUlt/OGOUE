<!DOCTYPE html>
<html class="light" lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Tableau de Bord - Digitalisation Comptable</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin/>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        /* Palette OGOUÉ - Redesign */
                        "primary": "#1de22e",
                        "secondary": "#1E3A5F",
                        "background-light": "#f6f8f6",
                        "background-dark": "#111712",
                        "card-light": "#FFFFFF",
                        "card-dark": "#1a2622",
                        "text-light-primary": "#0a0c0a",
                        "text-dark-primary": "#f6f8f6",
                        "text-light-secondary": "#5c6c60",
                        "text-dark-secondary": "#9ca3a8",
                        "border-light": "#e8ede8",
                        "border-dark": "#2a3a32",
                        "success": "#27AE60",
                        "danger": "#E74C3C",
                    },
                    fontFamily: { "display": ["Manrope", "sans-serif"] },
                    borderRadius: {
                        "DEFAULT": "1rem",
                        "lg": "2rem",
                        "xl": "3rem",
                        "full": "9999px"
                    },
                    boxShadow: {
                        "soft": "0 8px 20px rgba(29, 226, 46, 0.08)"
                    }
                },
            },
        }
    </script>

    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>

<body class="font-display bg-background-light dark:bg-background-dark text-text-light-primary dark:text-text-dark-primary">
<div class="relative flex min-h-screen w-full flex-col group/design-root overflow-x-hidden">

    <!-- ===== HEADER OGOUE ===== -->
    <header class="sticky top-0 z-10 w-full bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm border-b border-[#e8ede8] dark:border-gray-700">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between whitespace-nowrap h-20">
                <div class="flex items-center gap-4">
                    <a href="module_tableau_bord.html"><img src="/app/Logo-ogoue (2).png" alt="OGOUÉ Logo" class="h-28 w-auto"></a>
                </div>
                <div class="hidden md:flex items-center gap-9">
                    <a class="text-primary text-sm font-bold leading-normal" href="module_tableau_bord.html">Tableau de Bord</a>
                    <a class="text-[#0a0c0a] dark:text-gray-300 dark:hover:text-white text-sm font-medium leading-normal" href="module_ventes.html">Comptabilité</a>
                    <a class="text-[#0a0c0a] dark:text-gray-300 dark:hover:text-white text-sm font-medium leading-normal" href="module_scoring.html">Financement</a>
                </div>
                <!-- Menu mobile -->
                <div id="mobile-menu" class="md:hidden absolute top-full left-0 right-0 bg-background-light dark:bg-background-dark border-b border-[#e8ede8] dark:border-gray-700 hidden">
                    <div class="flex flex-col gap-2 p-4">
                        <a class="text-primary text-sm font-bold leading-normal py-2 px-3 rounded hover:bg-gray-100 dark:hover:bg-gray-800" href="module_tableau_bord.html">Tableau de Bord</a>
                        <a class="text-[#0a0c0a] dark:text-gray-300 text-sm font-medium leading-normal py-2 px-3 rounded hover:bg-gray-100 dark:hover:bg-gray-800" href="module_ventes.html">Comptabilité</a>
                        <a class="text-[#0a0c0a] dark:text-gray-300 text-sm font-medium leading-normal py-2 px-3 rounded hover:bg-gray-100 dark:hover:bg-gray-800" href="module_scoring.html">Financement</a>
                    </div>
                </div>
                <!-- Bouton menu mobile -->
                <button id="menu-toggle" class="md:hidden flex items-center justify-center w-10 h-10 rounded-full bg-primary/20 text-[#0a0c0a] dark:bg-primary/30 dark:text-white">
                    <span class="material-symbols-outlined">menu</span>
                </button>
                <div class="flex items-center gap-2">
                    <button class="flex h-10 w-10 cursor-pointer items-center justify-center overflow-hidden rounded-full bg-primary/20 text-[#0a0c0a] dark:bg-primary/30 dark:text-white" data-action="notifications">
                        <span class="material-symbols-outlined">notifications</span>
                    </button>
                    <button class="flex h-10 w-10 cursor-pointer items-center justify-center overflow-hidden rounded-full bg-primary/20 text-[#0a0c0a] dark:bg-primary/30 dark:text-white" data-action="settings">
                        <span class="material-symbols-outlined">settings</span>
                    </button>
                    <button class="flex h-10 w-10 cursor-pointer items-center justify-center rounded-full bg-primary/20 text-[#0a0c0a] dark:bg-primary/30 dark:text-white"
                         data-action="profile"
                         title="Profil utilisateur">
                        <span class="material-symbols-outlined text-2xl">account_circle</span>
                    </button>
                </div>
            </div>
        </div>
    </header>
    <!-- ===== FIN HEADER ===== -->

    <!-- ===== CONTENU DU TABLEAU DE BORD ===== -->
    <main class="flex-grow">
        <div class="container mx-auto px-4 py-8">
            <div class="layout-content-container flex flex-col w-full max-w-7xl mx-auto flex-1 gap-4">

                <!-- Titre de page -->
                <header class="flex flex-wrap justify-between items-center gap-3 px-4">
                    <div class="flex flex-col gap-1">
                        <p class="text-3xl md:text-4xl font-black leading-tight tracking-[-0.033em]">
                            Tableau de Bord Principal
                        </p>
                        <p class="text-text-light-secondary dark:text-text-dark-secondary text-sm md:text-base font-normal leading-normal">
                            Synthèse de la performance de votre entreprise.
                        </p>
                    </div>
                </header>

                <!-- Ligne avec bouton + filtre date -->
                <div class="border-b border-border-light dark:border-border-dark">
                    <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 px-4 pb-3 pt-2">

                        <!-- ✅ Bouton États financiers (à l'endroit entouré) -->
                        <a href="module_etats_financiers.html"
                           class="w-full md:w-auto inline-flex items-center justify-center gap-2
                                  h-11 px-5 rounded-xl
                                  bg-white dark:bg-card-dark
                                  border border-border-light dark:border-border-dark
                                  shadow-soft hover:shadow
                                  hover:border-primary/40 dark:hover:border-primary/40
                                  transition">
                            <span class="material-symbols-outlined text-primary">description</span>
                            <span class="text-sm font-bold text-text-light-primary dark:text-text-dark-primary">
                                Analyse financière
                            </span>
                            <span class="material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary">
                                chevron_right
                            </span>
                        </a>

                        <!-- Filtre par date -->
                        <div class="relative rounded-lg border border-border-light dark:border-border-dark bg-card-light dark:bg-card-dark px-3 py-2 shadow-sm w-full md:w-[240px]">
                            <p class="text-[10px] font-semibold uppercase tracking-wide text-text-light-secondary dark:text-text-dark-secondary mb-1">
                                Filtrer par date
                            </p>

                            <button
                                id="dateFilterButton"
                                type="button"
                                class="flex items-center justify-between gap-2 w-full h-10 rounded-md border border-gray-300 dark:border-gray-600 bg-background-light dark:bg-background-dark px-3 text-sm font-normal text-text-light-primary dark:text-text-dark-primary focus:outline-none focus:ring-2 focus:ring-primary/40"
                            >
                                <span id="dateFilterLabel" class="truncate text-[13px]"></span>
                                <span class="material-symbols-outlined text-lg text-gray-500 dark:text-gray-400">
                                    calendar_month
                                </span>
                            </button>

                            <!-- Panel calendrier -->
                            <div
                                id="dateFilterPanel"
                                class="absolute right-0 mt-2 w-[320px] rounded-xl border border-border-light dark:border-border-dark bg-white dark:bg-card-dark shadow-xl p-4 hidden z-20"
                            >
                                <!-- Header (mois + année éditable) -->
                                <div class="flex items-center justify-between gap-2 mb-3">
                                    <button id="prevMonth" type="button" class="p-1.5 rounded-full hover:bg-background-light dark:hover:bg-background-dark">
                                        <span class="material-symbols-outlined text-base text-gray-600 dark:text-gray-300">chevron_left</span>
                                    </button>

                                    <div class="flex items-center gap-2">
                                        <select
                                            id="monthSelect"
                                            class="h-9 rounded-lg border border-gray-300 dark:border-gray-600 bg-background-light dark:bg-background-dark px-2 text-sm text-text-light-primary dark:text-text-dark-primary focus:outline-none focus:ring-2 focus:ring-primary/40"
                                        ></select>

                                        <input
                                            id="yearInput"
                                            type="number"
                                            inputmode="numeric"
                                            min="1900"
                                            max="2200"
                                            class="h-9 w-[92px] rounded-lg border border-gray-300 dark:border-gray-600 bg-background-light dark:bg-background-dark px-2 text-sm text-text-light-primary dark:text-text-dark-primary focus:outline-none focus:ring-2 focus:ring-primary/40"
                                        />
                                    </div>

                                    <button id="nextMonth" type="button" class="p-1.5 rounded-full hover:bg-background-light dark:hover:bg-background-dark">
                                        <span class="material-symbols-outlined text-base text-gray-600 dark:text-gray-300">chevron_right</span>
                                    </button>
                                </div>

                                <!-- Jours semaine -->
                                <div class="grid grid-cols-7 text-center text-[11px] uppercase tracking-wide text-gray-400 dark:text-gray-500 mb-1">
                                    <span>l</span><span>m</span><span>m</span><span>j</span><span>v</span><span>s</span><span>d</span>
                                </div>

                                <!-- Grille -->
                                <div id="calendarGrid" class="grid grid-cols-7 gap-1 text-sm"></div>

                                <!-- Actions -->
                                <div class="flex justify-between items-center pt-3 mt-3 border-t border-border-light dark:border-border-dark">
                                    <button
                                        id="resetRange"
                                        type="button"
                                        class="text-xs px-3 py-1.5 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-background-light dark:hover:bg-background-dark"
                                    >
                                        Réinitialiser
                                    </button>
                                    <button
                                        id="closeCalendar"
                                        type="button"
                                        class="text-xs px-3 py-1.5 rounded-lg bg-primary text-[#0a0c0a] hover:bg-primary/90"
                                    >
                                        Fermer
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- ===== SECTION KPI ===== -->
                <section class="p-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="flex flex-col gap-2 rounded-xl p-6 bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark shadow-sm">
                            <p class="text-base font-medium text-text-light-secondary dark:text-text-dark-secondary">Chiffre d'Affaires</p>
                            <p id="kpi-chiffre-affaires" class="tracking-tight text-2xl xl:text-3xl font-bold whitespace-nowrap">-</p>
                            <p id="kpi-ca-trend" class="text-success text-sm font-semibold leading-normal flex items-center gap-1">
                                <span class="material-symbols-outlined !text-base">trending_up</span>
                                <span>Chargement...</span>
                            </p>
                        </div>

                        <div class="flex flex-col gap-2 rounded-xl p-6 bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark shadow-sm">
                            <p class="text-base font-medium text-text-light-secondary dark:text-text-dark-secondary">Dépenses</p>
                            <p id="kpi-depenses" class="tracking-tight text-2xl xl:text-3xl font-bold whitespace-nowrap">-</p>
                            <p id="kpi-depenses-trend" class="text-danger text-sm font-semibold leading-normal flex items-center gap-1">
                                <span class="material-symbols-outlined !text-base">trending_down</span>
                                <span>Chargement...</span>
                            </p>
                        </div>

                        <div class="flex flex-col gap-2 rounded-xl p-6 bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark shadow-sm">
                            <p class="text-base font-medium text-text-light-secondary dark:text-text-dark-secondary">Résultat Net</p>
                            <p id="kpi-resultat" class="tracking-tight text-2xl xl:text-3xl font-bold whitespace-nowrap">-</p>
                            <p id="kpi-resultat-trend" class="text-success text-sm font-semibold leading-normal flex items-center gap-1">
                                <span class="material-symbols-outlined !text-base">arrow_upward</span>
                                <span>Chargement...</span>
                            </p>
                        </div>
                    </div>
                </section>

                <!-- ===== SECTION GRAPHIQUES ===== -->
                <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 p-4">
                    <div class="lg:col-span-2 flex flex-col gap-4 rounded-xl border border-border-light dark:border-border-dark p-6 bg-card-light dark:bg-card-dark shadow-sm">
                        <p class="text-lg font-semibold">Évolution du Chiffre d'Affaires</p>
                        <div id="chart-evolution" class="flex min-h-[220px] flex-1 flex-col justify-end">
                            <!-- (SVG inchangé) -->
                            <svg fill="none" height="100%" preserveAspectRatio="none" viewBox="0 0 472 150" width="100%" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <linearGradient id="chartGradient" x1="236" x2="236" y1="1" y2="149" gradientUnits="userSpaceOnUse">
                                        <stop stop-color="#27AE60" stop-opacity="0.2"/>
                                        <stop offset="1" stop-color="#27AE60" stop-opacity="0"/>
                                    </linearGradient>
                                </defs>
                                <path d="M0 115C18.1538 115 18.1538 30 36.3077 30C54.4615 30 54.4615 50 72.6154 50C90.7692 50 90.7692 100 108.923 100C127.077 100 127.077 40 145.231 40C163.385 40 163.385 110 181.538 110C199.692 110 199.692 70 217.846 70C236 70 236 55 254.154 55C272.308 55 272.308 130 290.462 130C308.615 130 308.615 140 326.769 140C344.923 140 344.923 10 363.077 10C381.231 10 381.231 90 399.385 90C417.538 90 417.538 135 435.692 135C453.846 135 453.846 35 472 35" stroke="#94A3B8" stroke-dasharray="4 4" stroke-linecap="round" stroke-width="2"/>
                                <path d="M0 109C18.1538 109 18.1538 21 36.3077 21C54.4615 21 54.4615 41 72.6154 41C90.7692 41 90.7692 93 108.923 93C127.077 93 127.077 33 145.231 33C163.385 33 163.385 101 181.538 101C199.692 101 199.692 61 217.846 61C236 61 236 45 254.154 45C272.308 45 272.308 121 290.462 121C308.615 121 308.615 149 326.769 149C344.923 149 344.923 1 363.077 1C381.231 1 381.231 81 399.385 81C417.538 81 417.538 129 435.692 129C453.846 129 453.846 25 472 25" stroke="#27AE60" stroke-linecap="round" stroke-width="3"/>
                                <path d="M0 109C18.1538 109 18.1538 21 36.3077 21C54.4615 21 54.4615 41 72.6154 41C90.7692 41 90.7692 93 108.923 93C127.077 93 127.077 33 145.231 33C163.385 33 163.385 101 181.538 101C199.692 101 199.692 61 217.846 61C236 61 236 45 254.154 45C272.308 45 272.308 121 290.462 121C308.615 121 308.615 149 326.769 149C344.923 149 344.923 1 363.077 1C381.231 1 381.231 81 399.385 81C417.538 81 417.538 129 435.692 129C453.846 129 453.846 25 472 25V150H0V109Z" fill="url(#chartGradient)"/>
                            </svg>
                        </div>
                    </div>

                    <div id="chart-repartition" class="lg:col-span-1 flex flex-col gap-4 rounded-xl border border-border-light dark:border-border-dark p-6 bg-card-light dark:bg-card-dark shadow-sm">
                        <p class="text-lg font-semibold">Répartition du CA par Catégorie</p>
                        <div class="flex-1 flex items-center justify-center min-h-[220px] relative">
                            <svg class="w-full h-full" viewBox="0 0 36 36">
                                <circle class="stroke-current text-purple-400" cx="18" cy="18" r="15.9155" fill="transparent" stroke-width="3.5" stroke-dasharray="35 100" stroke-dashoffset="0"/>
                                <circle class="stroke-current text-teal-400" cx="18" cy="18" r="15.9155" fill="transparent" stroke-width="3.5" stroke-dasharray="30 100" stroke-dashoffset="-35"/>
                                <circle class="stroke-current text-orange-400" cx="18" cy="18" r="15.9155" fill="transparent" stroke-width="3.5" stroke-dasharray="20 100" stroke-dashoffset="-65"/>
                                <circle class="stroke-current text-sky-400" cx="18" cy="18" r="15.9155" fill="transparent" stroke-width="3.5" stroke-dasharray="15 100" stroke-dashoffset="-85"/>
                            </svg>
                            <div class="absolute flex flex-col items-center">
                                <span class="text-xs text-text-light-secondary dark:text-text-dark-secondary">Total</span>
                                <span class="text-2xl font-bold">12.5M</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-x-4 gap-y-2 pt-2 border-t border-border-light dark:border-border-dark text-sm">
                            <div class="flex items-center gap-2"><div class="size-2.5 rounded-full bg-purple-400"></div><span>Plomberie</span></div>
                            <div class="flex items-center gap-2"><div class="size-2.5 rounded-full bg-teal-400"></div><span>Matériaux</span></div>
                            <div class="flex items-center gap-2"><div class="size-2.5 rounded-full bg-orange-400"></div><span>Outillage</span></div>
                            <div class="flex items-center gap-2"><div class="size-2.5 rounded-full bg-sky-400"></div><span>Peinture</span></div>
                        </div>
                    </div>
                </section>

            </div>
        </div>
    </main>
</div>

<!-- Store OGOUÉ -->
<script src="js/ogoue-state.js"></script>
<script src="js/header-ui.js"></script>

<script>
/* =========================
   Date picker (mois + année saisissable)
   ========================= */
(function () {
    const btn = document.getElementById("dateFilterButton");
    const panel = document.getElementById("dateFilterPanel");
    const label = document.getElementById("dateFilterLabel");
    const grid = document.getElementById("calendarGrid");

    const prevBtn = document.getElementById("prevMonth");
    const nextBtn = document.getElementById("nextMonth");
    const closeBtn = document.getElementById("closeCalendar");
    const resetBtn = document.getElementById("resetRange");

    const monthSelect = document.getElementById("monthSelect");
    const yearInput = document.getElementById("yearInput");

    const months = [
        "janvier","février","mars","avril","mai","juin",
        "juillet","août","septembre","octobre","novembre","décembre"
    ];

    months.forEach((m, i) => {
        const opt = document.createElement("option");
        opt.value = String(i);
        opt.textContent = m;
        monthSelect.appendChild(opt);
    });

    function pad2(n){ return String(n).padStart(2,"0"); }
    function fmt(d){
        return `${pad2(d.getDate())}/${pad2(d.getMonth()+1)}/${d.getFullYear()}`;
    }
    function sameDay(a,b){
        return a && b &&
            a.getFullYear()===b.getFullYear() &&
            a.getMonth()===b.getMonth() &&
            a.getDate()===b.getDate();
    }
    function normalize(d){ return new Date(d.getFullYear(), d.getMonth(), d.getDate()); }

    let startDate = null;
    let endDate = null;

    let view = new Date();
    view = new Date(view.getFullYear(), view.getMonth(), 1);

    function setDefaultLabel(){
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
        startDate = firstDayOfMonth;
        endDate = today;
        updateLabel();
    }

    function syncMonthYearControls(){
        monthSelect.value = String(view.getMonth());
        yearInput.value = String(view.getFullYear());
    }

    function updateLabel(){
        if (startDate && endDate) label.textContent = `${fmt(startDate)} - ${fmt(endDate)}`;
        else if (startDate) label.textContent = fmt(startDate);
        else label.textContent = "Sélectionner une date";
        
        // Dispatch l'événement pour mettre à jour le dashboard
        if (startDate) {
            const startISO = `${startDate.getFullYear()}-${String(startDate.getMonth()+1).padStart(2,'0')}-${String(startDate.getDate()).padStart(2,'0')}`;
            const endISO = endDate ? `${endDate.getFullYear()}-${String(endDate.getMonth()+1).padStart(2,'0')}-${String(endDate.getDate()).padStart(2,'0')}` : startISO;
            document.dispatchEvent(new CustomEvent("dashboard:dateRangeChanged", { detail: { startDate: startISO, endDate: endISO } }));
        }
    }

    function inRange(d){
        if (!startDate || !endDate) return false;
        const t = d.getTime();
        return t >= startDate.getTime() && t <= endDate.getTime();
    }

    function render(){
        syncMonthYearControls();
        grid.innerHTML = "";

        const y = view.getFullYear();
        const m = view.getMonth();

        const first = new Date(y, m, 1);
        const last = new Date(y, m + 1, 0);

        const jsDay = first.getDay(); // 0=dimanche
        const offset = (jsDay + 6) % 7; // lundi=0

        for(let i=0;i<offset;i++){
            const el = document.createElement("div");
            el.className = "h-10";
            grid.appendChild(el);
        }

        for(let day=1; day<=last.getDate(); day++){
            const d = new Date(y, m, day);
            const dn = normalize(d);

            const isStart = startDate && sameDay(dn, startDate);
            const isEnd = endDate && sameDay(dn, endDate);
            const isIn = inRange(dn);

            const cell = document.createElement("button");
            cell.type = "button";
            cell.textContent = String(day);

            let base = "h-10 rounded-full flex items-center justify-center transition";
            let colors = "hover:bg-primary/15 dark:hover:bg-primary/20";

            if (isStart || isEnd) {
                colors = "bg-primary text-[#0a0c0a] font-semibold";
            } else if (isIn) {
                colors = "bg-primary/20 text-[#0a0c0a] dark:text-white";
            } else {
                colors += " text-text-light-primary dark:text-text-dark-primary";
            }

            cell.className = `${base} ${colors}`;

            cell.addEventListener("click", () => {
                const clicked = dn;

                if (!startDate || (startDate && endDate)) {
                    startDate = clicked;
                    endDate = null;
                } else {
                    if (clicked.getTime() < startDate.getTime()) {
                        endDate = startDate;
                        startDate = clicked;
                    } else {
                        endDate = clicked;
                    }
                }

                updateLabel();
                render();
            });

            grid.appendChild(cell);
        }
    }

    function openPanel(){
        panel.classList.remove("hidden");
        if (startDate) view = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
        syncMonthYearControls();
        render();
    }
    function closePanel(){
        panel.classList.add("hidden");
    }

    btn.addEventListener("click", (e) => {
        e.stopPropagation();
        panel.classList.contains("hidden") ? openPanel() : closePanel();
    });
    closeBtn.addEventListener("click", closePanel);

    document.addEventListener("click", (e) => {
        if (!panel.classList.contains("hidden")) {
            const inside = panel.contains(e.target) || btn.contains(e.target);
            if (!inside) closePanel();
        }
    });

    prevBtn.addEventListener("click", () => {
        view = new Date(view.getFullYear(), view.getMonth()-1, 1);
        render();
    });
    nextBtn.addEventListener("click", () => {
        view = new Date(view.getFullYear(), view.getMonth()+1, 1);
        render();
    });

    monthSelect.addEventListener("change", () => {
        const m = parseInt(monthSelect.value, 10);
        view = new Date(view.getFullYear(), m, 1);
        render();
    });

    function applyYear(){
        const y = parseInt(yearInput.value, 10);
        if (!Number.isFinite(y)) return;
        const clamped = Math.max(1900, Math.min(2200, y));
        view = new Date(clamped, view.getMonth(), 1);
        yearInput.value = String(clamped);
        render();
    }
    yearInput.addEventListener("change", applyYear);
    yearInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") applyYear();
    });

    resetBtn.addEventListener("click", () => {
        startDate = null;
        endDate = null;
        updateLabel();
        render();
    });

    setDefaultLabel();
    render();
})();
</script>

<script src="js/dashboard.js"></script>
<script src="js/topbar-actions.js"></script>
<script src="js/mobile-menu.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        if (window.OGOUE?.initTopbarActions) {
            window.OGOUE.initTopbarActions();
        }
    });
</script>

</body>
</html>
